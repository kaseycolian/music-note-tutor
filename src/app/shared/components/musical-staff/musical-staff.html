<div class="musical-staff-container" [attr.aria-label]="'Musical staff displaying ' + (currentNote()?.name || 'no note')">
  <svg
    [attr.viewBox]="'0 0 ' + staffWidth + ' ' + staffHeight"
    preserveAspectRatio="xMidYMid slice"
    class="staff-svg"
    role="img"
    [attr.alt]="'staff-description'"
    [attr.aria-describedby]="'staff-description'">

    <!-- Staff lines -->
    @for (lineY of staffLinePositions(); track lineY) {
      <line
        x1="50"
        [attr.y1]="lineY"
        [attr.x2]="staffWidth - 50"
        [attr.y2]="lineY"
        class="staff-line"
        stroke="#000"
        stroke-width="2" />
    }

    <!-- Clef symbol -->
    <text
      [attr.x]="clef() === 'bass' ? 85 : 75"
      [attr.y]="clef() === 'bass' ? staffCenterY + 31 : staffCenterY + 20"
      class="clef-symbol"
      font-family="serif"
      [attr.font-size]="clef() === 'bass' ? '95' : '85'"
      fill="#000"
      text-anchor="middle">
      {{ clefSymbol() }}
    </text>

    <!-- Ledger lines -->
    @if (showNote() && currentNote(); as note) {
      @for (ledger of ledgerLines(); track ledger.y) {
        <line
          [attr.x1]="ledger.x1"
          [attr.y1]="ledger.y"
          [attr.x2]="ledger.x2"
          [attr.y2]="ledger.y"
          class="ledger-line"
          stroke="#000"
          stroke-width="2" />
      }
    }

    <!-- Note display -->
    @if (showNote() && noteDisplayPosition(); as position) {
      <!-- Note head -->
      <g [attr.transform]="'translate(' + position.x + ',' + position.y + ') rotate(20) scale(1.2, 1.1)'">
        <ellipse
          cx="0"
          cy="0"
          [attr.rx]="noteRadius"
          [attr.ry]="noteRadius * 0.7"
          class="note"
          fill="none"
          stroke="#000"
          stroke-width="3.5"/>
      </g>

    }

    <!-- Visual feedback for empty state -->
    @if (!showNote() || !currentNote()) {
      <text
        [attr.x]="staffCenterX"
        [attr.y]="staffCenterY"
        class="placeholder-text"
        font-family="Arial, sans-serif"
        font-size="16"
        fill="#666"
        text-anchor="middle">
        Click "New Note" to start
      </text>
    }
  </svg>

  <!-- Screen reader description -->
  <div id="staff-description" class="sr-only">
    @if (currentNote(); as note) {
      Musical staff in {{ clef() }} clef showing in octave {{ note.octave }}.
    } @else {
      Musical staff in {{ clef() }} clef with no note displayed.
    }
  </div>

  <!-- Note information panel -->
  @if (showResult() && currentNote(); as note) {
    <div class="note-info" role="status" aria-live="polite">
      <span class="note-name">{{ note.name }}</span>
    </div>
  }
</div>
